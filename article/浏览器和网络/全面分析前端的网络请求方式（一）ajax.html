<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>全面分析前端的网络请求方式（一）ajax | 前端进阶</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="系统性学习，打造完善的知识体系">
    <link rel="preload" href="/blog/assets/css/0.styles.5dc057b1.css" as="style"><link rel="preload" href="/blog/assets/js/app.d7b4ca64.js" as="script"><link rel="preload" href="/blog/assets/js/2.d2cb7039.js" as="script"><link rel="preload" href="/blog/assets/js/43.d9d88890.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.b6d45109.js"><link rel="prefetch" href="/blog/assets/js/11.02c66630.js"><link rel="prefetch" href="/blog/assets/js/12.569c81c8.js"><link rel="prefetch" href="/blog/assets/js/13.2933a416.js"><link rel="prefetch" href="/blog/assets/js/14.e8b9a8eb.js"><link rel="prefetch" href="/blog/assets/js/15.cc49f41e.js"><link rel="prefetch" href="/blog/assets/js/16.fcf94bc8.js"><link rel="prefetch" href="/blog/assets/js/17.212491a7.js"><link rel="prefetch" href="/blog/assets/js/18.aba42cee.js"><link rel="prefetch" href="/blog/assets/js/19.7ca76503.js"><link rel="prefetch" href="/blog/assets/js/20.ef709027.js"><link rel="prefetch" href="/blog/assets/js/21.6dec212e.js"><link rel="prefetch" href="/blog/assets/js/22.2175430e.js"><link rel="prefetch" href="/blog/assets/js/23.72b7e27d.js"><link rel="prefetch" href="/blog/assets/js/24.1d369bec.js"><link rel="prefetch" href="/blog/assets/js/25.4a81ae13.js"><link rel="prefetch" href="/blog/assets/js/26.c516e806.js"><link rel="prefetch" href="/blog/assets/js/27.52b8ed02.js"><link rel="prefetch" href="/blog/assets/js/28.7200da10.js"><link rel="prefetch" href="/blog/assets/js/29.317911aa.js"><link rel="prefetch" href="/blog/assets/js/3.47a74f5f.js"><link rel="prefetch" href="/blog/assets/js/30.a92a3e89.js"><link rel="prefetch" href="/blog/assets/js/31.633db90e.js"><link rel="prefetch" href="/blog/assets/js/32.af4b30d4.js"><link rel="prefetch" href="/blog/assets/js/33.1a6245dc.js"><link rel="prefetch" href="/blog/assets/js/34.73a314bb.js"><link rel="prefetch" href="/blog/assets/js/35.67a47972.js"><link rel="prefetch" href="/blog/assets/js/36.b747b287.js"><link rel="prefetch" href="/blog/assets/js/37.c648cace.js"><link rel="prefetch" href="/blog/assets/js/38.30a84d00.js"><link rel="prefetch" href="/blog/assets/js/39.b63578f8.js"><link rel="prefetch" href="/blog/assets/js/4.3b6a7e49.js"><link rel="prefetch" href="/blog/assets/js/40.3a6f8db1.js"><link rel="prefetch" href="/blog/assets/js/41.9a72472f.js"><link rel="prefetch" href="/blog/assets/js/42.e28f36bb.js"><link rel="prefetch" href="/blog/assets/js/44.424aa53b.js"><link rel="prefetch" href="/blog/assets/js/45.0556d798.js"><link rel="prefetch" href="/blog/assets/js/46.92a18e35.js"><link rel="prefetch" href="/blog/assets/js/47.56e9f1e4.js"><link rel="prefetch" href="/blog/assets/js/48.4869689c.js"><link rel="prefetch" href="/blog/assets/js/49.8b4ade4a.js"><link rel="prefetch" href="/blog/assets/js/5.bc6e1aa4.js"><link rel="prefetch" href="/blog/assets/js/6.46556db1.js"><link rel="prefetch" href="/blog/assets/js/7.63a358f8.js"><link rel="prefetch" href="/blog/assets/js/8.088f79f0.js"><link rel="prefetch" href="/blog/assets/js/9.6c4360fc.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.5dc057b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/favicon.png" alt="前端进阶" class="logo"> <span class="site-name can-hide">前端进阶</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/article/" class="nav-link router-link-active">
  文章目录
</a></div><div class="nav-item"><a href="http://www.conardli.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/ConardLi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/article/" class="nav-link router-link-active">
  文章目录
</a></div><div class="nav-item"><a href="http://www.conardli.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/ConardLi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/article/" aria-current="page" class="sidebar-link">文章目录</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React深入系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>多端开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>浏览器和网络</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/浏览器和网络/全面分析前端的网络请求方式（一）ajax.html" class="active sidebar-link">全面分析前端的网络请求方式（一）ajax</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/article/浏览器和网络/全面分析前端的网络请求方式（一）ajax.html#一、前端进行网络请求的关注点" class="sidebar-link">一、前端进行网络请求的关注点</a></li><li class="sidebar-sub-header"><a href="/blog/article/浏览器和网络/全面分析前端的网络请求方式（一）ajax.html#二、前端进行网络请求的方式" class="sidebar-link">二、前端进行网络请求的方式</a></li><li class="sidebar-sub-header"><a href="/blog/article/浏览器和网络/全面分析前端的网络请求方式（一）ajax.html#三、关于网络请求的疑问" class="sidebar-link">三、关于网络请求的疑问</a></li><li class="sidebar-sub-header"><a href="/blog/article/浏览器和网络/全面分析前端的网络请求方式（一）ajax.html#四、ajax的出现解决了什么问题" class="sidebar-link">四、Ajax的出现解决了什么问题</a></li><li class="sidebar-sub-header"><a href="/blog/article/浏览器和网络/全面分析前端的网络请求方式（一）ajax.html#五、原生ajax的用法" class="sidebar-link">五、原生Ajax的用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/article/浏览器和网络/全面分析前端的网络请求方式（一）ajax.html#函数" class="sidebar-link">函数</a></li><li class="sidebar-sub-header"><a href="/blog/article/浏览器和网络/全面分析前端的网络请求方式（一）ajax.html#属性" class="sidebar-link">属性</a></li><li class="sidebar-sub-header"><a href="/blog/article/浏览器和网络/全面分析前端的网络请求方式（一）ajax.html#事件回调" class="sidebar-link">事件回调</a></li><li class="sidebar-sub-header"><a href="/blog/article/浏览器和网络/全面分析前端的网络请求方式（一）ajax.html#异常处理" class="sidebar-link">异常处理</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/article/浏览器和网络/全面分析前端的网络请求方式（一）ajax.html#六、jquery对ajax的封装" class="sidebar-link">六、jQuery对Ajax的封装</a></li></ul></li><li><a href="/blog/article/浏览器和网络/全面分析前端的网络请求方式（二）fetch.html" class="sidebar-link">全面分析前端的网络请求方式（二）fetch</a></li><li><a href="/blog/article/浏览器和网络/全面分析前端的网络请求方式（三）跨域.html" class="sidebar-link">全面分析前端的网络请求方式（三）跨域</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器策略</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>效果</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>博客搭建</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>综合</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术圈</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="一、前端进行网络请求的关注点"><a href="#一、前端进行网络请求的关注点" class="header-anchor">#</a> 一、前端进行网络请求的关注点</h2> <p>大多数情况下，在前端发起一个网络请求我们只需关注下面几点：</p> <ul><li>传入基本参数（<code>url</code>，请求方式）</li> <li>请求参数、请求参数类型</li> <li>设置请求头</li> <li>获取响应的方式</li> <li>获取响应头、响应状态、响应结果</li> <li>异常处理</li> <li>携带<code>cookie</code>设置</li> <li>跨域请求</li></ul> <h2 id="二、前端进行网络请求的方式"><a href="#二、前端进行网络请求的方式" class="header-anchor">#</a> 二、前端进行网络请求的方式</h2> <ul><li><code>form</code>表单、<code>ifream</code>、刷新页面</li> <li><code>Ajax</code> - 异步网络请求的开山鼻祖</li> <li><code>jQuery</code> - 一个时代</li> <li><code>fetch</code> - <code>Ajax</code>的替代者</li> <li><code>axios、request</code>等众多开源库</li></ul> <h2 id="三、关于网络请求的疑问"><a href="#三、关于网络请求的疑问" class="header-anchor">#</a> 三、关于网络请求的疑问</h2> <ul><li><code>Ajax</code>的出现解决了什么问题</li> <li>原生<code>Ajax</code>如何使用</li> <li><code>jQuery</code>的网络请求方式</li> <li><code>fetch</code>的用法以及坑点</li> <li>如何正确的使用<code>fetch</code></li> <li>如何选择合适的跨域方式</li></ul> <p>带着以上这些问题、关注点我们对几种网络请求进行一次全面的分析。</p> <h2 id="四、ajax的出现解决了什么问题"><a href="#四、ajax的出现解决了什么问题" class="header-anchor">#</a> 四、Ajax的出现解决了什么问题</h2> <p>在<code>Ajax</code>出现之前，<code>web</code>程序是这样工作的：</p> <p><img src="http://www.conardli.top/img/wl/wlqq_1.png" alt="image"></p> <p>这种交互的的缺陷是显而易见的，任何和服务器的交互都需要刷新页面，用户体验非常差，<code>Ajax</code>的出现解决了这个问题。<code>Ajax</code>全称<code>Asynchronous JavaScript + XML</code>（异步<code>JavaScript</code>和<code>XML</code>）</p> <p>使用<code>Ajax</code>，网页应用能够快速地将增量更新呈现在用户界面上，而不需要重载（刷新）整个页面。</p> <p><code>Ajax</code>本身不是一种新技术，而是用来描述一种使用现有技术集合实现的一个技术方案，浏览器的<code>XMLHttpRequest</code>是实现<code>Ajax</code>最重要的对象（<code>IE6</code>以下使用<code>ActiveXObject</code>）。</p> <p>尽管<code>X</code>在<code>Ajax</code>中代表<code>XML</code>, 但由于<code>JSON</code>的许多优势，比如更加轻量以及作为<code>Javascript</code>的一部分，目前<code>JSON</code>的使用比<code>XML</code>更加普遍。</p> <h2 id="五、原生ajax的用法"><a href="#五、原生ajax的用法" class="header-anchor">#</a> 五、原生Ajax的用法</h2> <p>这里主要分析<code>XMLHttpRequest</code>对象，下面是它的一段基础使用：</p> <div class="language-js extra-class"><pre class="language-js"><code>        <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'post'</span><span class="token punctuation">,</span><span class="token string">'www.xxx.com'</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token comment">// 接收返回值</span>
        xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 处理请求参数</span>
        postData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;name1&quot;</span><span class="token operator">:</span><span class="token string">&quot;value1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;name2&quot;</span><span class="token operator">:</span><span class="token string">&quot;value2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        postData <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> dataString <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> value<span class="token punctuation">)</span><span class="token punctuation">{</span>
             dataString <span class="token operator">+=</span> key<span class="token operator">+</span><span class="token string">&quot;=&quot;</span><span class="token operator">+</span>value<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> dataString<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">(</span>postData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置请求头</span>
        xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 异常处理</span>
        xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Network request failed'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 跨域携带cookie</span>
        xhr<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment">// 发出请求</span>
        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>postData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>下面分别对<code>XMLHttpRequest</code>对象常用的的函数、属性、事件进行分析。</p> <p><img src="http://www.conardli.top/img/wl/wlqq_2.png" alt="image"></p> <h3 id="函数"><a href="#函数" class="header-anchor">#</a> 函数</h3> <p><strong>open</strong></p> <p>用于初始化一个请求，用法：</p> <div class="language-js extra-class"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> async<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>method</code>：请求方式，如<code>get、post</code></li> <li><code>url</code>：请求的<code>url</code></li> <li><code>async</code>：是否为异步请求</li></ul> <p><strong>send</strong></p> <p>用于发送<code>HTTP</code>请求，即调用该方法后<code>HTTP</code>请求才会被真正发出，用法：</p> <div class="language-js extra-class"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span>
</code></pre></div><ul><li><code>param</code>：http请求的参数，可以为<code>string、Blob</code>等类型。</li></ul> <p><strong>abort</strong></p> <p>用于终止一个<code>ajax</code>请求，调用此方法后<code>readyState</code>将被设置为<code>0</code>，用法：</p> <div class="language-js extra-class"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>setRequestHeader</strong></p> <p>用于设置<code>HTTP</code>请求头，此方法必须在<code>open()</code>方法和<code>send()</code>之间调用，用法：</p> <div class="language-js extra-class"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>getResponseHeader</strong></p> <p>用于获取<code>http</code>返回头，如果在返回头中有多个一样的名称，那么返回的值就会是用逗号和空格将值分隔的字符串，用法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> header <span class="token operator">=</span> xhr<span class="token punctuation">.</span><span class="token function">getResponseHeader</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="属性"><a href="#属性" class="header-anchor">#</a> 属性</h3> <p><strong>readyState</strong></p> <p>用来标识当前<code>XMLHttpRequest</code>对象所处的状态，<code>XMLHttpRequest</code>对象总是位于下列状态中的一个：</p> <table><thead><tr><th>值</th> <th>状态</th> <th>描述</th></tr></thead> <tbody><tr><td>0</td> <td><code>UNSENT</code></td> <td>代理被创建，但尚未调用 <code>open()</code> 方法。</td></tr> <tr><td>1</td> <td><code>OPENED</code></td> <td><code>open()</code> 方法已经被调用。</td></tr> <tr><td>2</td> <td><code>HEADERS_RECEIVED</code></td> <td><code>send()</code>方法已经被调用，并且头部和状态已经可获得。</td></tr> <tr><td>3</td> <td><code>LOADING</code></td> <td>下载中； <code>responseText</code> 属性已经包含部分数据。</td></tr> <tr><td>4</td> <td><code>DONE</code></td> <td>下载操作已完成。</td></tr></tbody></table> <p><strong>status</strong></p> <p>表示<code>http</code>请求的状态, 初始值为<code>0</code>。如果服务器没有显式地指定状态码, 那么<code>status</code>将被设置为默认值, 即<code>200</code>。</p> <p><strong>responseType</strong></p> <p>表示响应的数据类型，并允许我们手动设置，如果为空，默认为<code>text</code>类型，可以有下面的取值：</p> <table><thead><tr><th>值</th> <th>描述</th></tr></thead> <tbody><tr><td><code>&quot;&quot;</code></td> <td>将 <code>responseType</code>设为空字符串与设置为<code>&quot;text&quot;</code>相同， 是默认类型 （实际上是 <code>DOMString</code>）。</td></tr> <tr><td><code>&quot;arraybuffer&quot;</code></td> <td><code>response</code> 是一个包含二进制数据的<code>JavaScript ArrayBuffer</code> 。</td></tr> <tr><td><code>&quot;blob&quot;</code></td> <td><code>response</code>是一个包含二进制数据的 <code>Blob</code> 对象 。</td></tr> <tr><td><code>&quot;document&quot;</code></td> <td>response 是一个<code>HTML Document</code>或<code>XML XMLDocument</code>，这取决于接收到的数据的 MIME 类型。</td></tr> <tr><td><code>&quot;json&quot;</code></td> <td><code>response</code> 是一个 JavaScript 对象。这个对象是通过将接收到的数据类型视为<code>JSON</code>解析得到的。</td></tr> <tr><td><code>&quot;text&quot;</code></td> <td><code>response</code>是包含在<code>DOMString</code>对象中的文本。</td></tr></tbody></table> <p><strong>response</strong></p> <p>返回响应的正文，返回的类型由上面的<code>responseType</code>决定。</p> <p><strong>withCredentials</strong></p> <p><code>ajax</code>请求默认会携带同源请求的<code>cookie</code>，而跨域请求则不会携带<code>cookie</code>，设置<code>xhr</code>的<code>withCredentials</code>的属性为<code>true</code>将允许携带跨域<code>cookie</code>。</p> <h3 id="事件回调"><a href="#事件回调" class="header-anchor">#</a> 事件回调</h3> <p><strong>onreadystatechange</strong></p> <div class="language-js extra-class"><pre class="language-js"><code> xhr<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> callback<span class="token punctuation">;</span>
</code></pre></div><p>当<code>readyState</code>属性发生变化时，callback会被触发。</p> <p><strong>onloadstart</strong></p> <div class="language-js extra-class"><pre class="language-js"><code> xhr<span class="token punctuation">.</span>onloadstart <span class="token operator">=</span> callback<span class="token punctuation">;</span>
</code></pre></div><p>在<code>ajax</code>请求发送之前（<code>readyState==1</code>后, <code>readyState==2</code>前），<code>callback</code>会被触发。</p> <p><strong>onprogress</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>loaded <span class="token operator">/</span> event<span class="token punctuation">.</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>回调函数可以获取资源总大小<code>total</code>，已经加载的资源大小<code>loaded</code>，用这两个值可以计算加载进度。</p> <p><strong>onload</strong></p> <div class="language-js extra-class"><pre class="language-js"><code> xhr<span class="token punctuation">.</span>onload <span class="token operator">=</span> callback<span class="token punctuation">;</span>
</code></pre></div><p>当一个资源及其依赖资源已完成加载时，将触发<code>callback</code>，通常我们会在<code>onload</code>事件中处理返回值。</p> <h3 id="异常处理"><a href="#异常处理" class="header-anchor">#</a> 异常处理</h3> <p><strong>onerror</strong></p> <div class="language-js extra-class"><pre class="language-js"><code> xhr<span class="token punctuation">.</span>onerror <span class="token operator">=</span> callback<span class="token punctuation">;</span>
</code></pre></div><p>当<code>ajax</code>资源加载失败时会触发<code>callback</code>。</p> <p><strong>ontimeout</strong></p> <div class="language-js extra-class"><pre class="language-js"><code> xhr<span class="token punctuation">.</span>ontimeout <span class="token operator">=</span> callback<span class="token punctuation">;</span>
</code></pre></div><p>当进度由于预定时间到期而终止时，会触发<code>callback</code>，超时时间可使用<code>timeout</code>属性进行设置。</p> <h2 id="六、jquery对ajax的封装"><a href="#六、jquery对ajax的封装" class="header-anchor">#</a> 六、jQuery对Ajax的封装</h2> <p>在很长一段时间里，人们使用<code>jQuery</code>提供的<code>ajax</code>封装进行网络请求，包括<code>$.ajax、$.get、$.post</code>等，这几个方法放到现在，我依然觉得很实用。</p> <div class="language-js extra-class"><pre class="language-js"><code>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    dataType<span class="token operator">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span> <span class="token comment">// 设置返回值类型</span>
    contentType<span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span> <span class="token comment">// 设置参数类型</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">'application/json'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 设置请求头</span>
    xhrFields<span class="token operator">:</span> <span class="token punctuation">{</span> withCredentials<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 跨域携带cookie</span>
    data<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>b<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> a<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 传递参数</span>
    <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xhr<span class="token punctuation">,</span>status</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// 错误处理</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">,</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>status</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 获取结果</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>$.ajax</code>只接收一个参数，这个参数接收一系列配置，其自己封装了一个<code>jqXHR</code>对象，有兴趣可以阅读一下<a href="https://github.com/jquery/jquery/blob/master/src/ajax.js" target="_blank" rel="noopener noreferrer">jQuary-ajax 源码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><img src="http://www.conardli.top/img/wl/wlqq_3.png" alt="image"></p> <p>常用配置：</p> <p><strong>url</strong></p> <p>当前页地址。发送请求的地址。</p> <p><strong>type</strong></p> <p>类型：<code>String</code> 请求方式 (<code>&quot;POST&quot;</code> 或<code>&quot;GET&quot;</code>)， 默认为 <code>&quot;GET&quot;</code>。注意：其它<code>HTTP</code>请求方法，如<code>PUT</code>和 <code>DELETE</code>也可以使用，但仅部分浏览器支持。</p> <p><strong>timeout</strong></p> <p>类型：<code>Number</code>设置请求超时时间（毫秒）。此设置将覆盖全局设置。</p> <p><strong>success</strong></p> <p>类型：<code>Function</code> 请求成功后的回调函数。</p> <p><strong>jsonp</strong></p> <p>在一个<code>jsonp</code>请求中重写回调函数的名字。这个值用来替代在<code>&quot;callback=?&quot;</code>这种<code>GET</code>或<code>POST</code>请求中<code>URL</code>参数里的<code>&quot;callback&quot;</code>部分。</p> <p><strong>error</strong> 类型：<code>Function</code> 。请求失败时调用此函数。</p> <p>注意：源码里对错误的判定：</p> <div class="language-js extra-class"><pre class="language-js"><code>isSuccess <span class="token operator">=</span> status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> status <span class="token operator">&lt;</span> <span class="token number">300</span> <span class="token operator">||</span> status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">;</span>
</code></pre></div><p>返回值除了这几个状态码都会进<code>error</code>回调。</p> <p><strong>dataType</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;xml&quot;</span><span class="token operator">:</span> 返回 <span class="token constant">XML</span> 文档，可用 jQuery 处理。
<span class="token string">&quot;html&quot;</span><span class="token operator">:</span> 返回纯文本 <span class="token constant">HTML</span> 信息；包含的 script 标签会在插入 dom 时执行。
<span class="token string">&quot;script&quot;</span><span class="token operator">:</span> 返回纯文本 JavaScript 代码。不会自动缓存结果。除非设置了 <span class="token string">&quot;cache&quot;</span> <span class="token function">参数。注意：在远程请求时</span><span class="token punctuation">(</span>不在同一个域下<span class="token punctuation">)</span>，所有 <span class="token constant">POST</span> 请求都将转为 <span class="token constant">GET</span> 请求。（因为将使用 <span class="token constant">DOM</span> 的 script标签来加载）
<span class="token string">&quot;json&quot;</span><span class="token operator">:</span> 返回 <span class="token constant">JSON</span> 数据 。
<span class="token string">&quot;jsonp&quot;</span><span class="token operator">:</span> <span class="token constant">JSONP</span> 格式。使用 <span class="token constant">JSONP</span> 形式调用函数时，如 <span class="token string">&quot;myurl?callback=?&quot;</span> jQuery 将自动替换 <span class="token operator">?</span> 为正确的函数名，以执行回调函数。
<span class="token string">&quot;text&quot;</span><span class="token operator">:</span> 返回纯文本字符串
</code></pre></div><p><strong>data</strong></p> <p>类型：<code>String</code> 使用<code>JSON.stringify</code>转码</p> <p><strong>complete</strong></p> <p>类型：<code>Function</code>请求完成后回调函数 (请求成功或失败之后均调用)。</p> <p><strong>async</strong></p> <p>类型：<code>Boolean</code> 默认值:<code>true</code>。默认设置下，所有请求均为异步请求。如果需要发送同步请求，请将此选项设置为 <code>false</code>。</p> <p><strong>contentType</strong></p> <p>类型：<code>String</code>默认值: <code>&quot;application/x-www-form-urlencoded&quot;</code>。发送信息至服务器时内容编码类型。</p> <p>键值对这样组织在一般的情况下是没有什么问题的，这里说的一般是，不带嵌套类型<code>JSON</code>，也就是 简单的<code>JSON</code>，形如这样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    c<span class="token operator">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但是在一些复杂的情况下就有问题了。 例如在 <code>Ajax</code>中你要传一个复杂的 <code>json</code> 对像，也就说是对象嵌数组，数组中包括对象，你这样传：<code>application/x-www-form-urlencoded</code> 这种形式是没有办法将复杂的<code>JSON</code>组织成键值对形式。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      x<span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以用如下方式传递复杂的<code>json</code>对象</p> <div class="language-js extra-class"><pre class="language-js"><code>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    dataType<span class="token operator">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span>
    contentType<span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>b<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> a<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/article/多端开发/用JS开发桌面应用（五）终篇.html" class="prev">
        用JS开发桌面应用（五）终篇
      </a></span> <span class="next"><a href="/blog/article/浏览器和网络/全面分析前端的网络请求方式（二）fetch.html">
        全面分析前端的网络请求方式（二）fetch
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.d7b4ca64.js" defer></script><script src="/blog/assets/js/2.d2cb7039.js" defer></script><script src="/blog/assets/js/43.d9d88890.js" defer></script>
  </body>
</html>
