<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰ | å‰ç«¯è¿›é˜¶</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="ç³»ç»Ÿæ€§å­¦ä¹ ï¼Œæ‰“é€ å®Œå–„çš„çŸ¥è¯†ä½“ç³»">
    <link rel="preload" href="/blog/assets/css/0.styles.5608eb1c.css" as="style"><link rel="preload" href="/blog/assets/js/app.8fcd38a4.js" as="script"><link rel="preload" href="/blog/assets/js/2.a8ace993.js" as="script"><link rel="preload" href="/blog/assets/js/15.d9cdf2b3.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.f36c27c0.js"><link rel="prefetch" href="/blog/assets/js/11.d6c12c6c.js"><link rel="prefetch" href="/blog/assets/js/12.0df38bfe.js"><link rel="prefetch" href="/blog/assets/js/13.4d4bb4bb.js"><link rel="prefetch" href="/blog/assets/js/14.cdc0e6d3.js"><link rel="prefetch" href="/blog/assets/js/16.946efa0b.js"><link rel="prefetch" href="/blog/assets/js/17.799a1b35.js"><link rel="prefetch" href="/blog/assets/js/18.fe526245.js"><link rel="prefetch" href="/blog/assets/js/19.4699c784.js"><link rel="prefetch" href="/blog/assets/js/20.21c13df1.js"><link rel="prefetch" href="/blog/assets/js/21.7534fac1.js"><link rel="prefetch" href="/blog/assets/js/22.7049615d.js"><link rel="prefetch" href="/blog/assets/js/23.4bd818cf.js"><link rel="prefetch" href="/blog/assets/js/24.9b358228.js"><link rel="prefetch" href="/blog/assets/js/25.d9a95492.js"><link rel="prefetch" href="/blog/assets/js/26.d93f886e.js"><link rel="prefetch" href="/blog/assets/js/27.03be430c.js"><link rel="prefetch" href="/blog/assets/js/28.8b289ad3.js"><link rel="prefetch" href="/blog/assets/js/29.524d7be9.js"><link rel="prefetch" href="/blog/assets/js/3.47a74f5f.js"><link rel="prefetch" href="/blog/assets/js/30.9bc33b23.js"><link rel="prefetch" href="/blog/assets/js/31.8c4bfa2c.js"><link rel="prefetch" href="/blog/assets/js/32.0dcda68c.js"><link rel="prefetch" href="/blog/assets/js/33.7bc70e96.js"><link rel="prefetch" href="/blog/assets/js/34.266af179.js"><link rel="prefetch" href="/blog/assets/js/35.a7b95c2f.js"><link rel="prefetch" href="/blog/assets/js/36.878df7d0.js"><link rel="prefetch" href="/blog/assets/js/37.4cfae8a0.js"><link rel="prefetch" href="/blog/assets/js/38.56c21b53.js"><link rel="prefetch" href="/blog/assets/js/39.19203471.js"><link rel="prefetch" href="/blog/assets/js/4.5ed19beb.js"><link rel="prefetch" href="/blog/assets/js/40.caf09cf6.js"><link rel="prefetch" href="/blog/assets/js/41.8f147132.js"><link rel="prefetch" href="/blog/assets/js/42.beea879e.js"><link rel="prefetch" href="/blog/assets/js/43.5c4819e9.js"><link rel="prefetch" href="/blog/assets/js/44.1a2d797d.js"><link rel="prefetch" href="/blog/assets/js/45.24702a7d.js"><link rel="prefetch" href="/blog/assets/js/46.6269bac3.js"><link rel="prefetch" href="/blog/assets/js/47.a142ddd7.js"><link rel="prefetch" href="/blog/assets/js/48.b625f601.js"><link rel="prefetch" href="/blog/assets/js/49.be923b08.js"><link rel="prefetch" href="/blog/assets/js/5.92efac1b.js"><link rel="prefetch" href="/blog/assets/js/6.66c0720b.js"><link rel="prefetch" href="/blog/assets/js/7.6b7b3729.js"><link rel="prefetch" href="/blog/assets/js/8.917e637e.js"><link rel="prefetch" href="/blog/assets/js/9.bf9f387a.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.5608eb1c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/favicon.png" alt="å‰ç«¯è¿›é˜¶" class="logo"> <span class="site-name can-hide">å‰ç«¯è¿›é˜¶</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/article/" class="nav-link router-link-active">
  æ–‡ç« ç›®å½•
</a></div><div class="nav-item"><a href="http://www.conardli.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/ConardLi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/article/" class="nav-link router-link-active">
  æ–‡ç« ç›®å½•
</a></div><div class="nav-item"><a href="http://www.conardli.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/ConardLi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/article/" aria-current="page" class="sidebar-link">æ–‡ç« ç›®å½•</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JSè¿›é˜¶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Reactæ·±å…¥ç³»åˆ—</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/setStateçš„æ‰§è¡Œæœºåˆ¶.html" class="sidebar-link">setStateçš„æ‰§è¡Œæœºåˆ¶</a></li><li><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/Reactä¸­keyçš„æ­£ç¡®ä½¿ç”¨æ–¹å¼.html" class="sidebar-link">Reactä¸­keyçš„æ­£ç¡®ä½¿ç”¨æ–¹å¼</a></li><li><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/Reactäº‹ä»¶æœºåˆ¶.html" class="sidebar-link">Reactäº‹ä»¶æœºåˆ¶</a></li><li><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆä¸€ï¼‰.html" class="sidebar-link">ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆä¸€ï¼‰</a></li><li><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html" class="active sidebar-link">ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html#é«˜é˜¶ç»„ä»¶-hoc" class="sidebar-link">é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰</a></li><li class="sidebar-sub-header"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html#hocçš„å®ç°æ–¹å¼" class="sidebar-link">HOCçš„å®ç°æ–¹å¼</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html#å±æ€§ä»£ç†" class="sidebar-link">å±æ€§ä»£ç†</a></li><li class="sidebar-sub-header"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html#åå‘ç»§æ‰¿" class="sidebar-link">åå‘ç»§æ‰¿</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html#hocå¯ä»¥å®ç°ä»€ä¹ˆåŠŸèƒ½" class="sidebar-link">HOCå¯ä»¥å®ç°ä»€ä¹ˆåŠŸèƒ½</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html#ç»„åˆæ¸²æŸ“" class="sidebar-link">ç»„åˆæ¸²æŸ“</a></li><li class="sidebar-sub-header"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html#æ¡ä»¶æ¸²æŸ“" class="sidebar-link">æ¡ä»¶æ¸²æŸ“</a></li><li class="sidebar-sub-header"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html#æ“ä½œprops" class="sidebar-link">æ“ä½œprops</a></li><li class="sidebar-sub-header"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html#è·å–refs" class="sidebar-link">è·å–refs</a></li><li class="sidebar-sub-header"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html#çŠ¶æ€ç®¡ç†" class="sidebar-link">çŠ¶æ€ç®¡ç†</a></li><li class="sidebar-sub-header"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html#æ“ä½œstate" class="sidebar-link">æ“ä½œstate</a></li><li class="sidebar-sub-header"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html#æ¸²æŸ“åŠ«æŒ" class="sidebar-link">æ¸²æŸ“åŠ«æŒ</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html#å¦‚ä½•ä½¿ç”¨hoc" class="sidebar-link">å¦‚ä½•ä½¿ç”¨HOC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html#compose" class="sidebar-link">compose</a></li><li class="sidebar-sub-header"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆäºŒï¼‰.html#decorators" class="sidebar-link">Decorators</a></li></ul></li></ul></li><li><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆä¸‰ï¼‰.html" class="sidebar-link">ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆä¸‰ï¼‰</a></li><li><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆå››ï¼‰.html" class="sidebar-link">ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆå››ï¼‰</a></li><li><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/æ·±å…¥åˆ†æè™šæ‹ŸDOMçš„æ¸²æŸ“åŸç†å’Œç‰¹æ€§.html" class="sidebar-link">æ·±å…¥åˆ†æè™šæ‹ŸDOMçš„æ¸²æŸ“åŸç†å’Œç‰¹æ€§</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å¤šç«¯å¼€å‘</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æµè§ˆå™¨å’Œç½‘ç»œ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æµè§ˆå™¨ç­–ç•¥</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å‰ç«¯å®‰å…¨</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å‰ç«¯å·¥ç¨‹åŒ–</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ•ˆæœ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>åšå®¢æ­å»º</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç»¼åˆ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æŠ€æœ¯åœˆ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="é«˜é˜¶ç»„ä»¶-hoc"><a href="#é«˜é˜¶ç»„ä»¶-hoc" class="header-anchor">#</a> é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰</h2> <p><img src="https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/hoc9.png" alt="image"></p> <p>é«˜é˜¶ç»„ä»¶å¯ä»¥çœ‹ä½œ<code>React</code>å¯¹è£…é¥°æ¨¡å¼çš„ä¸€ç§å®ç°ï¼Œé«˜é˜¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸”è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚</p> <blockquote><p>é«˜é˜¶ç»„ä»¶ï¼ˆ<code>HOC</code>ï¼‰æ˜¯<code>React</code>ä¸­çš„é«˜çº§æŠ€æœ¯ï¼Œç”¨æ¥é‡ç”¨ç»„ä»¶é€»è¾‘ã€‚ä½†é«˜é˜¶ç»„ä»¶æœ¬èº«å¹¶ä¸æ˜¯<code>React API</code>ã€‚å®ƒåªæ˜¯ä¸€ç§æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼æ˜¯ç”±<code>React</code>è‡ªèº«çš„ç»„åˆæ€§è´¨å¿…ç„¶äº§ç”Ÿçš„ã€‚</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">visible</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Component <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> visible<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>visible <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šé¢çš„ä»£ç å°±æ˜¯ä¸€ä¸ª<code>HOC</code>çš„ç®€å•åº”ç”¨ï¼Œå‡½æ•°æ¥æ”¶ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°ç»„ä»¶ï¼Œæ–°ç»„å»ºå¯ä»¥æ¥æ”¶ä¸€ä¸ª<code>visible props</code>ï¼Œæ ¹æ®<code>visible</code>çš„å€¼æ¥åˆ¤æ–­æ˜¯å¦æ¸²æŸ“Visibleã€‚</p> <p>ä¸‹é¢æˆ‘ä»¬ä»ä»¥ä¸‹å‡ æ–¹é¢æ¥å…·ä½“æ¢ç´¢<code>HOC</code>ã€‚</p> <p><img src="https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/hoc8.png" alt="image"></p> <h2 id="hocçš„å®ç°æ–¹å¼"><a href="#hocçš„å®ç°æ–¹å¼" class="header-anchor">#</a> HOCçš„å®ç°æ–¹å¼</h2> <h3 id="å±æ€§ä»£ç†"><a href="#å±æ€§ä»£ç†" class="header-anchor">#</a> å±æ€§ä»£ç†</h3> <p>å‡½æ•°è¿”å›ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç»„ä»¶ï¼Œç„¶ååœ¨<code>render</code>ä¸­è¿”å›è¦åŒ…è£¹çš„ç»„ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä»£ç†æ‰€æœ‰ä¼ å…¥çš„<code>props</code>ï¼Œå¹¶ä¸”å†³å®šå¦‚ä½•æ¸²æŸ“ï¼Œå®é™…ä¸Š ï¼Œè¿™ç§æ–¹å¼ç”Ÿæˆçš„é«˜é˜¶ç»„ä»¶å°±æ˜¯åŸç»„ä»¶çš„çˆ¶ç»„ä»¶ï¼Œä¸Šé¢çš„å‡½æ•°<code>visible</code>å°±æ˜¯ä¸€ä¸ª<code>HOC</code>å±æ€§ä»£ç†çš„å®ç°æ–¹å¼ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">proxyHOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Component <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¯¹æ¯”åŸç”Ÿç»„ä»¶å¢å¼ºçš„é¡¹ï¼š</p> <ul><li>å¯æ“ä½œæ‰€æœ‰ä¼ å…¥çš„<code>props</code></li> <li>å¯æ“ä½œç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</li> <li>å¯æ“ä½œç»„ä»¶çš„<code>static</code>æ–¹æ³•</li> <li>è·å–<code>refs</code></li></ul> <h3 id="åå‘ç»§æ‰¿"><a href="#åå‘ç»§æ‰¿" class="header-anchor">#</a> åå‘ç»§æ‰¿</h3> <p>è¿”å›ä¸€ä¸ªç»„ä»¶ï¼Œç»§æ‰¿åŸç»„ä»¶ï¼Œåœ¨<code>render</code>ä¸­è°ƒç”¨åŸç»„ä»¶çš„<code>render</code>ã€‚ç”±äºç»§æ‰¿äº†åŸç»„ä»¶ï¼Œèƒ½é€šè¿‡thisè®¿é—®åˆ°åŸç»„ä»¶çš„<code>ç”Ÿå‘½å‘¨æœŸã€propsã€stateã€render</code>ç­‰ï¼Œç›¸æ¯”å±æ€§ä»£ç†å®ƒèƒ½æ“ä½œæ›´å¤šçš„å±æ€§ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">inheritHOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> WrappedComponent <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¯¹æ¯”åŸç”Ÿç»„ä»¶å¢å¼ºçš„é¡¹ï¼š</p> <ul><li>å¯æ“ä½œæ‰€æœ‰ä¼ å…¥çš„<code>props</code></li> <li>å¯æ“ä½œç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</li> <li>å¯æ“ä½œç»„ä»¶çš„<code>static</code>æ–¹æ³•</li> <li>è·å–<code>refs</code></li> <li>å¯æ“ä½œ<code>state</code></li> <li>å¯ä»¥æ¸²æŸ“åŠ«æŒ</li></ul> <h2 id="hocå¯ä»¥å®ç°ä»€ä¹ˆåŠŸèƒ½"><a href="#hocå¯ä»¥å®ç°ä»€ä¹ˆåŠŸèƒ½" class="header-anchor">#</a> HOCå¯ä»¥å®ç°ä»€ä¹ˆåŠŸèƒ½</h2> <h3 id="ç»„åˆæ¸²æŸ“"><a href="#ç»„åˆæ¸²æŸ“" class="header-anchor">#</a> ç»„åˆæ¸²æŸ“</h3> <p>å¯ä½¿ç”¨ä»»ä½•å…¶ä»–ç»„ä»¶å’ŒåŸç»„ä»¶è¿›è¡Œç»„åˆæ¸²æŸ“ï¼Œè¾¾åˆ°æ ·å¼ã€å¸ƒå±€å¤ç”¨ç­‰æ•ˆæœã€‚</p> <blockquote><p>é€šè¿‡å±æ€§ä»£ç†å®ç°</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">stylHOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Component <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;title&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>é€šè¿‡åå‘ç»§æ‰¿å®ç°</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">styleHOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> WrappedComponent <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;title&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="æ¡ä»¶æ¸²æŸ“"><a href="#æ¡ä»¶æ¸²æŸ“" class="header-anchor">#</a> æ¡ä»¶æ¸²æŸ“</h3> <p>æ ¹æ®ç‰¹å®šçš„å±æ€§å†³å®šåŸç»„ä»¶æ˜¯å¦æ¸²æŸ“</p> <blockquote><p>é€šè¿‡å±æ€§ä»£ç†å®ç°</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">visibleHOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Component <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>visible <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>é€šè¿‡åå‘ç»§æ‰¿å®ç°</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">visibleHOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> WrappedComponent <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>visible <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="æ“ä½œprops"><a href="#æ“ä½œprops" class="header-anchor">#</a> æ“ä½œprops</h3> <p>å¯ä»¥å¯¹ä¼ å…¥ç»„ä»¶çš„<code>props</code>è¿›è¡Œå¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤æˆ–è€…æ ¹æ®ç‰¹å®šçš„<code>props</code>è¿›è¡Œç‰¹æ®Šçš„æ“ä½œã€‚</p> <blockquote><p>é€šè¿‡å±æ€§ä»£ç†å®ç°</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">proxyHOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Component <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> newProps <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">,</span>
        user<span class="token operator">:</span> <span class="token string">'ConardLi'</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span>newProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="è·å–refs"><a href="#è·å–refs" class="header-anchor">#</a> è·å–refs</h3> <p>é«˜é˜¶ç»„ä»¶ä¸­å¯è·å–åŸç»„ä»¶çš„<code>ref</code>ï¼Œé€šè¿‡<code>ref</code>è·å–ç»„ä»¶å®åŠ›ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼Œå½“ç¨‹åºåˆå§‹åŒ–å®Œæˆåè°ƒç”¨åŸç»„ä»¶çš„logæ–¹æ³•ã€‚(ä¸çŸ¥é“refsæ€ä¹ˆç”¨ï¼Œè¯·ğŸ‘‡<a href="https://react.docschina.org/docs/refs-and-the-dom.html" target="_blank" rel="noopener noreferrer">Refs &amp; DOM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p> <blockquote><p>é€šè¿‡å±æ€§ä»£ç†å®ç°</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">refHOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Component <span class="token punctuation">{</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>wapperRef<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">ref</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>wapperRef <span class="token operator">=</span> ref <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™é‡Œæ³¨æ„ï¼šè°ƒç”¨é«˜é˜¶ç»„ä»¶çš„æ—¶å€™å¹¶ä¸èƒ½è·å–åˆ°åŸç»„ä»¶çš„çœŸå®<code>ref</code>ï¼Œéœ€è¦æ‰‹åŠ¨è¿›è¡Œä¼ é€’ï¼Œå…·ä½“è¯·çœ‹<a href="#%E4%BC%A0%E9%80%92refs">ä¼ é€’refs</a></p> <h3 id="çŠ¶æ€ç®¡ç†"><a href="#çŠ¶æ€ç®¡ç†" class="header-anchor">#</a> çŠ¶æ€ç®¡ç†</h3> <p>å°†åŸç»„ä»¶çš„çŠ¶æ€æå–åˆ°<code>HOC</code>ä¸­è¿›è¡Œç®¡ç†ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼Œæˆ‘ä»¬å°†<code>Input</code>çš„<code>value</code>æå–åˆ°<code>HOC</code>ä¸­è¿›è¡Œç®¡ç†ï¼Œä½¿å®ƒå˜æˆå—æ§ç»„ä»¶ï¼ŒåŒæ—¶ä¸å½±å“å®ƒä½¿ç”¨<code>onChange</code>æ–¹æ³•è¿›è¡Œä¸€äº›å…¶ä»–æ“ä½œã€‚åŸºäºè¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªç®€å•çš„<code>åŒå‘ç»‘å®š</code>ï¼Œå…·ä½“è¯·çœ‹<a href="#%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A">åŒå‘ç»‘å®š</a>ã€‚</p> <blockquote><p>é€šè¿‡å±æ€§ä»£ç†å®ç°</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">proxyHoc</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Component <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> onChange <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        value<span class="token operator">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> onChange <span class="token operator">===</span><span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token function">onChange</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> newProps <span class="token operator">=</span> <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        onChange<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onChange<span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>newProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">HOC</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>input<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">proxyHoc</span><span class="token punctuation">(</span><span class="token constant">HOC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="æ“ä½œstate"><a href="#æ“ä½œstate" class="header-anchor">#</a> æ“ä½œstate</h3> <p>ä¸Šé¢çš„ä¾‹å­é€šè¿‡å±æ€§ä»£ç†åˆ©ç”¨HOCçš„stateå¯¹åŸç»„ä»¶è¿›è¡Œäº†ä¸€å®šçš„å¢å¼ºï¼Œä½†å¹¶ä¸èƒ½ç›´æ¥æ§åˆ¶åŸç»„ä»¶çš„<code>state</code>ï¼Œè€Œé€šè¿‡åå‘ç»§æ‰¿ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ“ä½œåŸç»„ä»¶çš„<code>state</code>ã€‚ä½†æ˜¯å¹¶ä¸æ¨èç›´æ¥ä¿®æ”¹æˆ–æ·»åŠ åŸç»„ä»¶çš„<code>state</code>ï¼Œå› ä¸ºè¿™æ ·æœ‰å¯èƒ½å’Œç»„ä»¶å†…éƒ¨çš„æ“ä½œæ„æˆå†²çªã€‚</p> <blockquote><p>é€šè¿‡åå‘ç»§æ‰¿å®ç°</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">debugHOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> WrappedComponent <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'props'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;debuging&quot;</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šé¢çš„<code>HOC</code>åœ¨<code>render</code>ä¸­å°†<code>props</code>å’Œ<code>state</code>æ‰“å°å‡ºæ¥ï¼Œå¯ä»¥ç”¨ä½œè°ƒè¯•é˜¶æ®µï¼Œå½“ç„¶ä½ å¯ä»¥åœ¨é‡Œé¢å†™æ›´å¤šçš„è°ƒè¯•ä»£ç ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œåªéœ€è¦åœ¨æˆ‘ä»¬æƒ³è¦è°ƒè¯•çš„ç»„ä»¶ä¸ŠåŠ ä¸Š<code>@debug</code>å°±å¯ä»¥å¯¹è¯¥ç»„ä»¶è¿›è¡Œè°ƒè¯•ï¼Œè€Œä¸éœ€è¦åœ¨æ¯æ¬¡è°ƒè¯•çš„æ—¶å€™å†™å¾ˆå¤šå†—ä½™ä»£ç ã€‚(å¦‚æœä½ è¿˜ä¸çŸ¥é“æ€ä¹ˆä½¿ç”¨HOCï¼Œè¯·ğŸ‘‡<a href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8HOC">å¦‚ä½•ä½¿ç”¨HOC</a>)</p> <h3 id="æ¸²æŸ“åŠ«æŒ"><a href="#æ¸²æŸ“åŠ«æŒ" class="header-anchor">#</a> æ¸²æŸ“åŠ«æŒ</h3> <p>é«˜é˜¶ç»„ä»¶å¯ä»¥åœ¨renderå‡½æ•°ä¸­åšéå¸¸å¤šçš„æ“ä½œï¼Œä»è€Œæ§åˆ¶åŸç»„ä»¶çš„æ¸²æŸ“è¾“å‡ºã€‚åªè¦æ”¹å˜äº†åŸç»„ä»¶çš„æ¸²æŸ“ï¼Œæˆ‘ä»¬éƒ½å°†å®ƒç§°ä¹‹ä¸ºä¸€ç§<code>æ¸²æŸ“åŠ«æŒ</code>ã€‚</p> <p>å®é™…ä¸Šï¼Œä¸Šé¢çš„<a href="#%E7%BB%84%E5%90%88%E6%B8%B2%E6%9F%93">ç»„åˆæ¸²æŸ“</a>å’Œ<a href="#%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93">æ¡ä»¶æ¸²æŸ“</a>éƒ½æ˜¯<code>æ¸²æŸ“åŠ«æŒ</code>çš„ä¸€ç§ï¼Œé€šè¿‡åå‘ç»§æ‰¿ï¼Œä¸ä»…å¯ä»¥å®ç°ä»¥ä¸Šä¸¤ç‚¹ï¼Œè¿˜å¯ç›´æ¥<code>å¢å¼º</code>ç”±åŸç»„ä»¶<code>render</code>å‡½æ•°äº§ç”Ÿçš„<code>Reactå…ƒç´ </code>ã€‚</p> <blockquote><p>é€šè¿‡åå‘ç»§æ‰¿å®ç°</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">hijackHOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> WrappedComponent <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> tree <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> newProps <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>tree <span class="token operator">&amp;&amp;</span> tree<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'input'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        newProps <span class="token operator">=</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">'æ¸²æŸ“è¢«åŠ«æŒäº†'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> props <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> tree<span class="token punctuation">.</span>props<span class="token punctuation">,</span> newProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> newTree <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">cloneElement</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> props<span class="token punctuation">,</span> tree<span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> newTree<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ³¨æ„ä¸Šé¢çš„è¯´æ˜æˆ‘ç”¨çš„æ˜¯<code>å¢å¼º</code>è€Œä¸æ˜¯<code>æ›´æ”¹</code>ã€‚<code>render</code>å‡½æ•°å†…å®é™…ä¸Šæ˜¯è°ƒç”¨<code>React.creatElement</code>äº§ç”Ÿçš„<code>Reactå…ƒç´ </code>ï¼š</p> <p><img src="https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/hoc1.png" alt="image">
è™½ç„¶æˆ‘ä»¬èƒ½æ‹¿åˆ°å®ƒï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½ç›´æ¥ä¿®æ”¹å®ƒé‡Œé¢çš„å±æ€§ï¼Œæˆ‘ä»¬é€šè¿‡<code>getOwnPropertyDescriptors</code>å‡½æ•°æ¥æ‰“å°ä¸‹å®ƒçš„é…ç½®é¡¹ï¼š</p> <p><img src="https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/hoc2.png" alt="image"></p> <p>å¯ä»¥å‘ç°ï¼Œæ‰€æœ‰çš„<code>writable</code>å±æ€§å‡è¢«é…ç½®ä¸ºäº†<code>false</code>ï¼Œå³æ‰€æœ‰å±æ€§æ˜¯ä¸å¯å˜çš„ã€‚ï¼ˆå¯¹è¿™äº›é…ç½®é¡¹æœ‰ç–‘é—®ï¼Œè¯·ğŸ‘‡<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener noreferrer">defineProperty<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼‰</p> <p>ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©<code>cloneElement</code>æ–¹æ³•æ¥åœ¨åŸç»„ä»¶çš„åŸºç¡€ä¸Šå¢å¼ºä¸€ä¸ªæ–°ç»„ä»¶ï¼š</p> <blockquote><p><code>React.cloneElement()</code>å…‹éš†å¹¶è¿”å›ä¸€ä¸ªæ–°çš„<code>Reactå…ƒç´ </code>ï¼Œä½¿ç”¨<code>element</code>ä½œä¸ºèµ·ç‚¹ã€‚ç”Ÿæˆçš„å…ƒç´ å°†ä¼šæ‹¥æœ‰åŸå§‹å…ƒç´ propsä¸æ–°propsçš„æµ…åˆå¹¶ã€‚æ–°çš„å­çº§ä¼šæ›¿æ¢ç°æœ‰çš„å­çº§ã€‚æ¥è‡ªåŸå§‹å…ƒç´ çš„ key å’Œ ref å°†ä¼šä¿ç•™ã€‚</p></blockquote> <p><code>React.cloneElement()</code>å‡ ä¹ç›¸å½“äºï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>element<span class="token punctuation">.</span>type <span class="token punctuation">{</span><span class="token operator">...</span>element<span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>element<span class="token punctuation">.</span>type<span class="token operator">&gt;</span>
</code></pre></div><h2 id="å¦‚ä½•ä½¿ç”¨hoc"><a href="#å¦‚ä½•ä½¿ç”¨hoc" class="header-anchor">#</a> å¦‚ä½•ä½¿ç”¨HOC</h2> <p>ä¸Šé¢çš„ç¤ºä¾‹ä»£ç éƒ½å†™çš„æ˜¯å¦‚ä½•å£°æ˜ä¸€ä¸ª<code>HOC</code>ï¼Œ<code>HOC</code>å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¦å¢å¼ºçš„ç»„ä»¶ä½œä¸ºå‚æ•°è°ƒç”¨<code>HOC</code>å‡½æ•°ï¼Œå¾—åˆ°å¢å¼ºåçš„ç»„ä»¶ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">myComponent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>åŸç»„ä»¶<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">inheritHOC</span><span class="token punctuation">(</span>myComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="compose"><a href="#compose" class="header-anchor">#</a> compose</h3> <p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸€ä¸ªç»„ä»¶å¯èƒ½è¢«å¤šä¸ª<code>HOC</code>å¢å¼ºï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯è¢«æ‰€æœ‰çš„<code>HOC</code>å¢å¼ºåçš„ç»„ä»¶ï¼Œå€Ÿç”¨ä¸€å¼ <code>è£…é¥°æ¨¡å¼</code>çš„å›¾æ¥è¯´æ˜ï¼Œå¯èƒ½æ›´å®¹æ˜“ç†è§£ï¼š</p> <p><img src="https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/hoc3.jpeg" alt="image"></p> <p>å‡è®¾ç°åœ¨æˆ‘ä»¬æœ‰<code>logger</code>ï¼Œ<code>visible</code>ï¼Œ<code>style</code>ç­‰å¤šä¸ª<code>HOC</code>ï¼Œç°åœ¨è¦åŒæ—¶å¢å¼ºä¸€ä¸ª<code>Input</code>ç»„ä»¶ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">logger</span><span class="token punctuation">(</span><span class="token function">visible</span><span class="token punctuation">(</span><span class="token function">style</span><span class="token punctuation">(</span>Input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>è¿™ç§ä»£ç éå¸¸çš„éš¾ä»¥é˜…è¯»ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å°è£…ä¸€ä¸ªç®€å•çš„å‡½æ•°ç»„åˆå·¥å…·ï¼Œå°†å†™æ³•æ”¹å†™å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>fns</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> fns<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f<span class="token punctuation">,</span> g</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">compose</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span>visible<span class="token punctuation">,</span>style<span class="token punctuation">)</span><span class="token punctuation">(</span>Input<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>compose</code>å‡½æ•°è¿”å›ä¸€ä¸ªæ‰€æœ‰å‡½æ•°ç»„åˆåçš„å‡½æ•°ï¼Œ<code>compose(f, g, h)</code> å’Œ <code>(...args) =&gt; f(g(h(...args)))</code>æ˜¯ä¸€æ ·çš„ã€‚</p> <p>å¾ˆå¤šç¬¬ä¸‰æ–¹åº“éƒ½æä¾›äº†ç±»ä¼¼<code>compose</code>çš„å‡½æ•°ï¼Œä¾‹å¦‚<code>lodash.flowRight</code>ï¼Œ<code>Redux</code>æä¾›çš„<code>combineReducers</code>å‡½æ•°ç­‰ã€‚</p> <h3 id="decorators"><a href="#decorators" class="header-anchor">#</a> Decorators</h3> <p>æˆ‘ä»¬è¿˜å¯ä»¥å€ŸåŠ©<code>ES7</code>ä¸ºæˆ‘ä»¬æä¾›çš„<code>Decorators</code>æ¥è®©æˆ‘ä»¬çš„å†™æ³•å˜çš„æ›´åŠ ä¼˜é›…ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>@logger
@visible
@style
<span class="token keyword">class</span> <span class="token class-name">Input</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Decorators</code>æ˜¯<code>ES7</code>çš„ä¸€ä¸ªææ¡ˆï¼Œè¿˜æ²¡æœ‰è¢«æ ‡å‡†åŒ–ï¼Œä½†ç›®å‰<code>Babel</code>è½¬ç å™¨å·²ç»æ”¯æŒï¼Œæˆ‘ä»¬éœ€è¦æå‰é…ç½®<code>babel-plugin-transform-decorators-legacy</code>ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;transform-decorators-legacy&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>è¿˜å¯ä»¥ç»“åˆä¸Šé¢çš„<code>compose</code>å‡½æ•°ä½¿ç”¨ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> hoc <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span> visible<span class="token punctuation">,</span> style<span class="token punctuation">)</span><span class="token punctuation">;</span>
@hoc
<span class="token keyword">class</span> <span class="token class-name">Input</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ–‡ä¸­å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡æ­£ï¼Œè°¢è°¢é˜…è¯»ã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆä¸€ï¼‰.html" class="prev">
        ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆä¸€ï¼‰
      </a></span> <span class="next"><a href="/blog/article/Reactæ·±å…¥ç³»åˆ—/ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆä¸‰ï¼‰.html">
        ä»Mixinåˆ°HOCå†åˆ°Hookï¼ˆä¸‰ï¼‰
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.8fcd38a4.js" defer></script><script src="/blog/assets/js/2.a8ace993.js" defer></script><script src="/blog/assets/js/15.d9cdf2b3.js" defer></script>
  </body>
</html>
