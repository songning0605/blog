<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从网络协议的角度聊一聊最近Github被大规模攻击事件 | 前端进阶</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="系统性学习，打造完善的知识体系">
    <link rel="preload" href="/blog/assets/css/0.styles.5dc057b1.css" as="style"><link rel="preload" href="/blog/assets/js/app.d7b4ca64.js" as="script"><link rel="preload" href="/blog/assets/js/2.d2cb7039.js" as="script"><link rel="preload" href="/blog/assets/js/18.aba42cee.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.b6d45109.js"><link rel="prefetch" href="/blog/assets/js/11.02c66630.js"><link rel="prefetch" href="/blog/assets/js/12.569c81c8.js"><link rel="prefetch" href="/blog/assets/js/13.2933a416.js"><link rel="prefetch" href="/blog/assets/js/14.e8b9a8eb.js"><link rel="prefetch" href="/blog/assets/js/15.cc49f41e.js"><link rel="prefetch" href="/blog/assets/js/16.fcf94bc8.js"><link rel="prefetch" href="/blog/assets/js/17.212491a7.js"><link rel="prefetch" href="/blog/assets/js/19.7ca76503.js"><link rel="prefetch" href="/blog/assets/js/20.ef709027.js"><link rel="prefetch" href="/blog/assets/js/21.6dec212e.js"><link rel="prefetch" href="/blog/assets/js/22.2175430e.js"><link rel="prefetch" href="/blog/assets/js/23.72b7e27d.js"><link rel="prefetch" href="/blog/assets/js/24.1d369bec.js"><link rel="prefetch" href="/blog/assets/js/25.4a81ae13.js"><link rel="prefetch" href="/blog/assets/js/26.c516e806.js"><link rel="prefetch" href="/blog/assets/js/27.52b8ed02.js"><link rel="prefetch" href="/blog/assets/js/28.7200da10.js"><link rel="prefetch" href="/blog/assets/js/29.317911aa.js"><link rel="prefetch" href="/blog/assets/js/3.47a74f5f.js"><link rel="prefetch" href="/blog/assets/js/30.a92a3e89.js"><link rel="prefetch" href="/blog/assets/js/31.633db90e.js"><link rel="prefetch" href="/blog/assets/js/32.af4b30d4.js"><link rel="prefetch" href="/blog/assets/js/33.1a6245dc.js"><link rel="prefetch" href="/blog/assets/js/34.73a314bb.js"><link rel="prefetch" href="/blog/assets/js/35.67a47972.js"><link rel="prefetch" href="/blog/assets/js/36.b747b287.js"><link rel="prefetch" href="/blog/assets/js/37.c648cace.js"><link rel="prefetch" href="/blog/assets/js/38.30a84d00.js"><link rel="prefetch" href="/blog/assets/js/39.b63578f8.js"><link rel="prefetch" href="/blog/assets/js/4.3b6a7e49.js"><link rel="prefetch" href="/blog/assets/js/40.3a6f8db1.js"><link rel="prefetch" href="/blog/assets/js/41.9a72472f.js"><link rel="prefetch" href="/blog/assets/js/42.e28f36bb.js"><link rel="prefetch" href="/blog/assets/js/43.d9d88890.js"><link rel="prefetch" href="/blog/assets/js/44.424aa53b.js"><link rel="prefetch" href="/blog/assets/js/45.0556d798.js"><link rel="prefetch" href="/blog/assets/js/46.92a18e35.js"><link rel="prefetch" href="/blog/assets/js/47.56e9f1e4.js"><link rel="prefetch" href="/blog/assets/js/48.4869689c.js"><link rel="prefetch" href="/blog/assets/js/49.8b4ade4a.js"><link rel="prefetch" href="/blog/assets/js/5.bc6e1aa4.js"><link rel="prefetch" href="/blog/assets/js/6.46556db1.js"><link rel="prefetch" href="/blog/assets/js/7.63a358f8.js"><link rel="prefetch" href="/blog/assets/js/8.088f79f0.js"><link rel="prefetch" href="/blog/assets/js/9.6c4360fc.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.5dc057b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/favicon.png" alt="前端进阶" class="logo"> <span class="site-name can-hide">前端进阶</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/article/" class="nav-link router-link-active">
  文章目录
</a></div><div class="nav-item"><a href="http://www.conardli.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/ConardLi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/article/" class="nav-link router-link-active">
  文章目录
</a></div><div class="nav-item"><a href="http://www.conardli.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/ConardLi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/article/" aria-current="page" class="sidebar-link">文章目录</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React深入系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>多端开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器和网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器策略</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端安全</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/前端安全/从网络协议的角度聊一聊最近Github被大规模攻击事件.html" class="active sidebar-link">从网络协议的角度聊一聊最近Github被大规模攻击事件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/article/前端安全/从网络协议的角度聊一聊最近Github被大规模攻击事件.html#您的连接不是私密连接" class="sidebar-link">您的连接不是私密连接</a></li><li class="sidebar-sub-header"><a href="/blog/article/前端安全/从网络协议的角度聊一聊最近Github被大规模攻击事件.html#为什么强制-https-访问" class="sidebar-link">为什么强制 Https 访问</a></li><li class="sidebar-sub-header"><a href="/blog/article/前端安全/从网络协议的角度聊一聊最近Github被大规模攻击事件.html#浏览器如何建立安全链接" class="sidebar-link">浏览器如何建立安全链接</a></li><li class="sidebar-sub-header"><a href="/blog/article/前端安全/从网络协议的角度聊一聊最近Github被大规模攻击事件.html#浏览器如何验证ssl-tls证书有效" class="sidebar-link">浏览器如何验证SSL/TLS证书有效?</a></li><li class="sidebar-sub-header"><a href="/blog/article/前端安全/从网络协议的角度聊一聊最近Github被大规模攻击事件.html#bgp-劫持" class="sidebar-link">BGP 劫持</a></li></ul></li><li><a href="/blog/article/前端安全/依赖安全漏洞.html" class="sidebar-link">前端依赖安全漏洞</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>效果</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>博客搭建</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>综合</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术圈</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>3月27日 <code>Github</code> 疑似遭受大规模攻击， <code>desktop.github.com 、 pages.github.com 、 *.github.io</code> 等多个站点均提示 &quot;您的连接不是私密连接&quot;，并且电信、移动、联通、教育网均可复现该问题。</p> <p><img src="https://lsqimg-1257917459.cos.ap-beijing.myqcloud.com/20200330203128.png" alt=""></p> <h2 id="您的连接不是私密连接"><a href="#您的连接不是私密连接" class="header-anchor">#</a> 您的连接不是私密连接</h2> <h2 id="为什么强制-https-访问"><a href="#为什么强制-https-访问" class="header-anchor">#</a> 为什么强制 Https 访问</h2> <p>你在访问 <code>http://github.com</code> 的时候，会发现浏览器只允许你通过 <code>HTTPS</code> 访问，这是因为 <code>Github</code> 开启了 <code>HSTS</code>，它告诉浏览器只能通过 <code>HTTPS</code> 访问。</p> <p>如果开启了 <code>HSTS</code>，你可以在控制台看到 <code>Strict-Transport-Security</code> 这个标头：</p> <p><img src="https://lsqimg-1257917459.cos.ap-beijing.myqcloud.com/20200330204347.png" alt=""></p> <p>这个请求头可以设置下面几个属性：</p> <ul><li><code>max-age=&lt;expire-time&gt;</code>：设置在浏览器收到这个请求后的<code>&lt;expire-time&gt;</code>秒的时间内凡是访问这个域名下的请求都使用<code>HTTPS</code>请求。</li> <li><code>includeSubDomains</code>(可选)：如果这个可选的参数被指定，那么说明此规则也适用于该网站的所有子域名。</li> <li><code>preload</code> 支持预加载 <code>HSTS</code>。</li></ul> <p>如果一个网站接受一个 <code>HTTP</code> 的请求，然后跳转到 <code>HTTPS</code>，用户可能在开始跳转前，通过没有加密的方式和服务器对话，比如，用户输入 <code>http://github.com</code> 或者直接 <code>github.com</code>。</p> <p>这样存在中间人攻击潜在威胁，跳转过程可能被恶意网站利用来直接接触用户信息，而不是原来的加密信息。</p> <p>网站通过 <code>HTTP Strict Transport Security</code> 通知浏览器，这个网站禁止使用 <code>HTTP</code> 方式加载，浏览器应该自动把所有尝试使用 <code>HTTP</code> 的请求自动替换为 <code>HTTPS</code> 请求。</p> <p>所以，<code>github</code> 开启了 <code>HSTS</code> 意味着我们只能从用 <code>HTTPS</code> 来访问它，但是这时候站点的中间某个环节出了问题导致无法建立安全链接，所以无法访问，那么浏览器是如何与服务端建立安全链接的呢？</p> <h2 id="浏览器如何建立安全链接"><a href="#浏览器如何建立安全链接" class="header-anchor">#</a> 浏览器如何建立安全链接</h2> <p>客户端和服务端建立安全连接，一般需要经历以下几个步骤：</p> <ul><li>客户端给出协议的版本号、一个客户端生成的随机数和客户端支持的加密算法；</li> <li>服务端在客户端给出的加密算法列表中选出一种，并给出数字证书和一个服务端生成的额随机数；</li> <li>客户端确认数字证书的有效性，然后生成一个新的随机数，并使用数字证书中的公钥加密这个随机数；</li> <li>服务端使用私钥解密，获取客户端发来的随机数；</li> <li>客户端和服务端根据约定的加密方法，使用之前的三个随机数，生成对话密钥，这个密钥会用来加密接下来的整个通信过程。</li></ul> <p>实际上这里的过程复杂的多，这里只是简要描述，看了很多解释，还是《图解 HTTP》的解释最为经典：</p> <p><img src="https://lsqimg-1257917459.cos.ap-beijing.myqcloud.com/20200331000556.png" alt=""></p> <p>那么，以上任何一个步骤出了问题，浏览器都不能建立安全链接。</p> <p>当浏览器出现 “您的连接不是私密连接” 这种情况，一般就是浏览器校验证书除了问题，那么浏览器如何验证<code>SSL/TLS</code>证书有效呢？</p> <h2 id="浏览器如何验证ssl-tls证书有效"><a href="#浏览器如何验证ssl-tls证书有效" class="header-anchor">#</a> 浏览器如何验证SSL/TLS证书有效?</h2> <p><img src="https://lsqimg-1257917459.cos.ap-beijing.myqcloud.com/20200330234327.png" alt=""></p> <ul><li>检查证书是否是由浏览器中“受信任的根证书颁发机构”颁发</li></ul> <p>每一张证书都是由上级<code>CA</code>证书签发的，上级<code>CA</code>证书可能还有上级，最后会找到根证书。最终浏览器会验证证书是否是由浏览器中“受信任的根证书颁发机构”颁发。</p> <ul><li>检查证书中的证书吊销列表，检查证书是否被证书颁发机构吊销</li></ul> <p>证书吊销列表(<code>CRL</code>)证书被吊销后会被记录在<code>CRL</code>中，<code>CA</code>会定期发布<code>CRL</code>。应用程序可以依靠<code>CRL</code>来检查证书是否被吊销了。</p> <ul><li>通过在线证书状态协议检测证书是否有效</li></ul> <p>在线证书状态协议(<code>OCSP</code>)。除了证书吊销列表离线文件，证书颁发者也会提供实时的查询接口，查询某个特定证书目前是否有效。实时查询的问题在于浏览器需要等待这个查询结束才能继续<code>TLS</code>握手，延迟会更大。以上是站点在证书颁发者的角度说明会提供的两种判断方式，实际情况下浏览器究竟会选择哪种方式判断。</p> <ul><li>检查此证书是否过期</li></ul> <p>证书中会包含证书的有效期的起始时间和结束时间，取其中一个即可判断。</p> <ul><li><p>检查部署此证书的网站的域名是否与证书中的域名一致</p></li> <li><p>IE7浏览器会到欺诈网站数据库查询此网站是否已经被列入欺诈网站黑名单</p></li></ul> <p>浏览器需经过以上几个方面的检查后，才会在页面显示安全锁标志，正常显示部署了<code>SSL/TLS</code>证书的加密页面。</p> <p>如果这期间任何一个流程验证出错，那么浏览器就无法建立安全链接，最终提示 &quot;您的连接不是私密连接&quot;。</p> <p>打开这个不受信任的证书，显示该证书的颁布者是<code>346608453@qq.com</code>。</p> <p><img src="https://lsqimg-1257917459.cos.ap-beijing.myqcloud.com/20200330235138.png" alt=""></p> <p>查询该QQ号码，显示其昵称为心即山灵，地址为黑龙江哈尔滨。打开他的QQ空间，发现他发了一条动态说自己的QQ被盗了，这里很明显有点掩盗铃的感觉，因为攻击者要生成<code>CA</code>证书的话，随便填个邮箱都可以，还需要盗你的号么？</p> <p><img src="https://lsqimg-1257917459.cos.ap-beijing.myqcloud.com/20200330235348.png" alt=""></p> <p>从攻击者自签名证书留下的<code>QQ</code>号可以在网上搜寻到部分信息，信息显示此前这名攻击者正在学习加密技术。这名攻击者还曾在技术交流网站求助他人发送相关源代码，从已知信息判断攻击者可能是在学习后尝试发起攻击。看了看这老哥的留言，已经火了。。</p> <p><img src="https://lsqimg-1257917459.cos.ap-beijing.myqcloud.com/20200330235715.png" alt=""></p> <p>很显然，这个证书被劫持了，而且这个证书肯定是不会被浏览器信任的，这才会导致浏览器无法建立安全链接，从而访问失败。</p> <p>然而问题又来了，三大运营商纷纷中招，什么样的攻击能控制如此大的范围呢？</p> <h2 id="bgp-劫持"><a href="#bgp-劫持" class="header-anchor">#</a> BGP 劫持</h2> <p><code>BGP</code> 表示边界网关协议，它是 <code>Internet</code> 的路由协议，它提供了方向，以便流量尽可能有效地从一个 <code>IP</code> 地址传播到另一个 <code>IP</code> 地址。换句话说，它帮助我们高效地查找 <code>A</code> 服务器到 <code>B</code> 服务器的最佳路由路径。<code>DNS</code>（域名系统）服务器提供 <code>IP</code> 地址，但是 <code>BGP</code> 提供了最有效的方法来访问该 <code>IP</code> 地址。粗略地说，如果 <code>DNS</code> 是 <code>Internet</code> 的通讯簿，则 <code>BGP</code> 是 <code>Internet</code> 的路线图。</p> <p><code>AS</code> 指的是一个区域中大量计算机组成的网络，中国各家运营商管理着相应的 <code>AS</code>。</p> <p><code>BGP</code> 劫持就是某些 <code>AS</code> 通过宣称自己拥有某个 <code>IP</code> 地址，而将对该 <code>IP</code> 地址的请求引向一些恶意服务器。</p> <p>这里参考下一位知乎网友的图，画的很清晰：</p> <p><img src="https://lsqimg-1257917459.cos.ap-beijing.myqcloud.com/20200331001737.png" alt=""></p> <p>用户知道 <code>github.com</code> 的 <code>IP</code> 地址后，从 <code>AS 1</code> 出发，正常来说，应该访问在 <code>AS 4</code> 的 Github 服务器，但是 <code>AS 5</code> 与 <code>AS 6</code> 欺骗 <code>BGP</code> 它拥有 <code>github.com</code> 的 <code>IP</code> 地址并且误导 <code>BGP</code> 的路径经过它，于是用户变成访问 <code>AS 6</code> 服务器，但是用户还以为自己连接的是正确的服务器（根据 <code>IP</code> 地址）。万幸的是，由于 <code>AS 6</code> 的服务器无法提供正确的 <code>Github</code> 证书。所以 <code>HTTPS</code> 连接无法正确建立。</p> <p>攻击者使用 <code>BGP</code> 劫持将 <code>github.com</code> 的 <code>IP</code> 指向了使用 <code>346608453@qq.com</code> 自签名的证书的服务器，由于浏览器无法信任该证书，导致页面访问失败，这就是整个事件的原因了。。</p> <p><img src="https://lsqimg-1257917459.cos.ap-beijing.myqcloud.com/20200331001412.png" alt=""></p> <p>因为 <code>BGP</code> 提供了最有效的方法来访问该 <code>IP</code> 地址，所以<code>BGP</code>劫持几乎是不可能停止的，想象一下，如果没有人在看高速公路标志，唯一的方式告诉如果他们被恶意更改是通过观察，很多汽车最终在错误的社区。然而，为了使劫持发生，攻击者需要控制或破坏连接一个自治系统(AS)和另一个自治系统(AS)的启用了BGP的路由器，因此不是每个人都可以执行BGP劫持。</p> <p>这样的事情早就不是第一次发生，<code>2008</code> 年巴基斯坦的 <code>ISP</code> 运营商就使用 <code>BGP</code> 劫持屏蔽用户浏览 <code>Youtube</code>。<code>2018</code> 年，黑客通过 <code>BGP</code> 劫持将重定向了亚马逊 <code>DNS</code> 服务器的流量，然后盗取加密货币。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/article/浏览器策略/当浏览器全面禁用三方Cookie.html" class="prev">
        当浏览器全面禁用三方Cookie
      </a></span> <span class="next"><a href="/blog/article/前端安全/依赖安全漏洞.html">
        前端依赖安全漏洞
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.d7b4ca64.js" defer></script><script src="/blog/assets/js/2.d2cb7039.js" defer></script><script src="/blog/assets/js/18.aba42cee.js" defer></script>
  </body>
</html>
